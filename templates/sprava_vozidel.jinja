{% extends '__main.jinja' %}

{% block content %}
    {% include '__menu.jinja' %}
    <div class="container">
        <div class="page-header">
            <h1 class="page-title">Správa vozidel</h1>
        </div>

        {% if 'user_id' in session and session['role_id'] in [1, 8] %} 
        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 2rem; margin-bottom: 3rem;">
            <!-- Add Vehicle -->
            <div class="auth-container" style="width: 100%; max-width: none;">
                <h2 style="margin-bottom: 1.5rem; text-align: center;">Přidávání vozidel</h2>
                <form method="POST" action="/sprava_vozidel.zmena_vozidla">
                    {% if 'user_id' in session and session['role_id'] in [1] %} 
                    <div class="form-group">
                        <label for="uzivatel">Uživatel</label>
                        <input type="text" id="uzivatel" name="uzivatel">
                    </div>
                    {% endif %}
                    <div class="form-group">
                        <label for="nazev">Název</label>
                        <input type="text" id="nazev" name="nazev">
                    </div>
                    <div class="form-group">
                        <label for="SPZ">SPZ</label>
                        <input type="text" id="SPZ" name="spz">
                    </div>
                    <button class="btn btn-primary btn-full" type="submit" name="pridej_nove_vozidlo">Přidej nové vozidlo</button>
                </form>
            </div>

            <!-- List Vehicles -->
            <div class="auth-container" style="width: 100%; max-width: none;">
                <h2 style="margin-bottom: 1.5rem; text-align: center;">Registrovaná auta</h2>
                <div style="max-height: 300px; overflow-y: auto;">
                    {% for auto in vozidla %}
                        <div style="padding: 0.5rem; border-bottom: 1px solid var(--border-color);">
                            <strong>{{ auto.nazev_vozidla }}</strong> | SPZ: {{ auto.spz }}
                        </div>
                    {% endfor %}
                </div>
            </div>

            <!-- Remove Vehicle -->
            <div class="auth-container" style="width: 100%; max-width: none;">
                <h2 style="margin-bottom: 1.5rem; text-align: center;">Odstranění vozidla</h2>
                <form method="POST" action="/sprava_vozidel.zmena_vozidla">
                    {% if 'user_id' in session and session['role_id'] in [1] %} 
                    <div class="form-group">
                        <label for="spz_od">SPZ</label>
                        <input type="text" id="spz_od" name="spz_od">
                    </div>
                    {% endif %}
                    <div class="form-group">
                        <label for="nazev_odstranit">Název vozidla</label>
                        <input type="text" id="nazev_odstranit" name="nazev_odstranit">
                    </div>
                    <button class="btn btn-primary btn-full" type="submit" name="odstranit_vozidlo" style="background-color: var(--error);">Odstraň vozidlo</button>
                </form>
            </div>
        </div>
        {% endif %}

        {% if 'user_id' in session and session['role_id'] in [1, 6, 7, 5] %}
        <div class="page-header">
            <h2 class="page-title">Aktuální operace na autech</h2>
        </div>
        <div style="overflow-x: auto;">
            <table>
                <thead>
                    <tr>
                        <th>Uživatel</th>
                        <th>Stav</th>
                        <th>Typ</th>
                        <th>Vozidlo</th>
                        <th>Datum</th>
                        <th>ID</th>  
                    </tr>
                </thead>
                <tbody>
                    {% for operace in operace %}
                        <tr>
                            <td>{{ operace.user.username }}</td>
                            <td>
                                <form method="POST" action="{{ url_for('sprava_vozidel.zmena_stavu') }}" style="display: flex; gap: 0.5rem; align-items: center;">
                                    <input type="hidden" name="id_sluzby" value="{{ operace.id_sluzby }}">
                                    <select name="novy_stav" style="padding: 0.25rem; border-radius: var(--radius-sm); background-color: var(--bg-primary); color: var(--text-primary); border: 1px solid var(--border-color);">
                                        <option value="neprovedeno" {% if operace.stav == 'neprovedeno' %}selected{% endif %}>Neprovedeno</option>
                                        <option value="provedeno" {% if operace.stav == 'provedeno' %}selected{% endif %}>Provedeno</option>
                                        <option value="v_procesu" {% if operace.stav == 'v_procesu' %}selected{% endif %}>V procesu</option>
                                    </select>
                                    <button type="submit" class="btn btn-primary" style="padding: 0.25rem 0.5rem; font-size: 0.8rem;">Uložit</button>
                                </form>
                            </td>
                            <td>{{ operace.druh_sluzby.nazev }}</td>
                            <td>{{ operace.vozidlo.nazev_vozidla }}</td>
                            <td>{{ operace.datum }}</td>
                            <td>{{ operace.id_sluzby}}</td>
                        </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
        {% endif %}
    </div>
{% endblock %}