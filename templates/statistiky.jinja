{% extends '__main.jinja' %}

{% block content %}
    {% include '__menu.jinja' %}
    <div class="container">
        <div class="page-header">
            <h1 class="page-title">Zprávy a statistiky</h1>
        </div>

        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 2rem; margin-bottom: 3rem;">
            <!-- Statistics Table -->
            <div class="auth-container" style="width: 100%; max-width: none;">
                <h2 style="margin-bottom: 1.5rem; text-align: center;">Přehled operací</h2>
                <table>
                    <thead>
                        <tr>
                            <th>Oddělení</th>
                            <th>Nezahájeno</th>
                            <th>V procesu</th>
                            <th>Dokončeno</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% if 'user_id' in session and session['role_id'] in [1, 3] %} 
                        <tr>
                            <td>Servis</td>
                            <td>{{ pocty_operaci['neprovedeno']['Servis'] }}</td>
                            <td>{{ pocty_operaci['v_procesu']['Servis'] }}</td>
                            <td>{{ pocty_operaci['provedeno']['Servis'] }}</td>
                        </tr>
                        {% endif %}
                        {% if 'user_id' in session and session['role_id'] in [1, 4] %} 
                        <tr>
                            <td>Likvidace</td>
                            <td>{{ pocty_operaci['neprovedeno']['Likvidace'] }}</td>
                            <td>{{ pocty_operaci['v_procesu']['Likvidace'] }}</td>
                            <td>{{ pocty_operaci['provedeno']['Likvidace'] }}</td>
                        </tr>
                        {% endif %}
                        {% if 'user_id' in session and session['role_id'] in [1, 2] %} 
                        <tr>
                            <td>Technická kontrola</td>
                            <td>{{ pocty_operaci['neprovedeno']['Technická kontrola'] }}</td>
                            <td>{{ pocty_operaci['v_procesu']['Technická kontrola'] }}</td>
                            <td>{{ pocty_operaci['provedeno']['Technická kontrola'] }}</td>
                        </tr>
                        {% endif %}
                    </tbody>
                </table>
            </div>

            <!-- Filter Form -->
            <div class="auth-container" style="width: 100%; max-width: none;">
                <h2 style="margin-bottom: 1.5rem; text-align: center;">Filtrovat výpis</h2>
                <form id="form2" action="{{ url_for('zpravy_statistiky.filtruj') }}" method="POST">
                    <div class="form-group">
                        <label for="vypis_zacatek">Začátek:</label>
                        <input type="date" id="vypis_zacatek" name="vypis_zacatek">
                    </div>
                    <div class="form-group">
                        <label for="vypis_konec">Konec:</label>
                        <input type="date" id="vypis_konec" name="vypis_konec">
                    </div>
                    <button class="btn btn-primary btn-full" type="submit">Filtruj výpis</button>
                </form>
            </div>
        </div>

        <!-- Filtered Results -->
        <div class="page-header">
            <h2 class="page-title">Filtrovaný výpis</h2>
        </div>
        <div style="overflow-x: auto;">
            <table>
                <thead>
                    <tr>
                        <th>Uživatel</th>
                        <th>Stav</th>
                        <th>Typ</th>
                        <th>Vozidlo</th>
                        <th>Datum</th>
                    </tr>
                </thead>
                <tbody>
                    {% for operace in filtrace %}
                        <tr>
                            <td>{{ operace.user.username }}</td>
                            <td>{{ operace.stav }}</td>
                            <td>{{ operace.druh_sluzby.nazev }}</td>
                            <td>{{ operace.vozidlo.nazev_vozidla }}</td>
                            <td>{{ operace.datum }}</td>
                        </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
{% endblock %}
